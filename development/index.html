<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link href="css/style.css" rel="stylesheet">
        <title>Concert Map</title>

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA8B9NC0lW-vqhQzWmVp8XwEMFbyg01blI&libraries=places"></script>

    </head>

    <body>
        <!-- GOOGLE MAP -->
        <div class="map-canvas" data-bind="googlemap: { mapBounds: mapBounds() }"></div>

        <!-- INFO WINDOW CONTENT -->
        <div class="info-window-container" style="display: none;">
            <div class="info-content" data-bind="if: currentVenue">
                <div data-bind="with: currentVenue">
                    <h2 class="window-header clickable" data-bind="text: name, click: selectVenue;"></h2>
                    <ul data-bind="foreach: concerts">
                        <li class="clickable" data-bind="click: selectEvent">
                            <hr>
                            <h4>
                                <span data-bind="text: artists[0].name"></span> 
                                <span class="subtitle" data-bind="text: subtitle"></span>
                            </h4>

                            <p class="window-event-date pale-text">
                                <!-- TODO: make new timeinfo
                                //'<span data-bind="text: datetime"></span>, ' +-->
                                <span data-bind="text: timeInfo.day"></span>, 
                                <span data-bind="text: timeInfo.date"></span>
                            </p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- MENU TOGGLE -->
        <a class="menu-toggle clickable" data-bind="click: function() { toggleMenu() }, css: { open: showMenu() }">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M2 6h20v3H2zm0 5h20v3H2zm0 5h20v3H2z"/>
          </svg>
        </a>

        <!-- EVENT SEARCH -->
        <input class="menu-interface event-search search-box" data-bind="hasFocus: searchBarFocus, textInput: searchInput, css: { open: showMenu() }" placeholder="search concerts">

        <!-- ASK IF USER WANTS LAST.FM ARTIST INFO -->
        <!-- ko if: askForArtistInfo() -->
        <!-- ko template: { name: 'request-info' } --><!-- /ko -->
        <script type="text/html" id="request-info">
            <div class="request-artist-info">
                <h4>Want better search results?</h4>
                <p>If you choose to request info about each artist from Last.fm, you'll be able to search events by detailed info about the artists, such as genre.</p>
                <p>Right now you can only search events by artists' names and venues' names and addresses.</p>
                <p> Note: Last.fm info usually loads quickly, but may be slow depending on Last.fm's servers</p>
                <div>
                    <button class="clickable" data-bind="click: function() { requestAllArtistInfo(true); dontAsk(true);}">Yes</button><button class="clickable" data-bind="click: function() { manualToggle(false); }">No</button><button class="clickable" data-bind="click: function() { dontAsk(true); }">Don't Ask Again</button>
                </div>
            </div>
        </script>
        <!-- /ko -->

        <!-- LOCATION SEARCH -->
        <input class="location-search menu-interface search-box" data-bind="value: currentAddress, css: { open: showMenu() }">

        <!-- INFO LIST TOGGLE -->
        <div class="list-toggle menu-interface" data-bind="css: { open: showMenu() }">
            <button class="list-button clickable" data-bind="css: { pressed: listEvents() }, click: function () { showEvents(); }">EVENTS</button><button class="list-button clickable" data-bind="css: { pressed: listVenues() }, click: function () { showVenues(); }">VENUES</button>
            <button class="info-button clickable" data-bind="css: { pressed: extraInfoBoolean() }, click: toggleExtraInfo">SHOW INFO POP-UP</button>
        </div>

        <div class="menu-interface list-container" data-bind="css: { open: showMenu() }">
            <p class="map-error"></p>
            <p data-bind="visible: !filteredEvents().length && !concertsStatus">no results</p>
            <p data-bind="text: concertsStatus"></p>
            <p data-bind="text: geocoderStatus"></p>
            <p data-bind="text: allArtistStatusUpdate"></p>
            <p data-bind="if: searchInput">Search Results for: "<span data-bind="text: searchInput"></span>"</p>

            <!-- EVENT LIST -->
            <concerts-list params="
                mapCenter: mapCenter,
                concerts: concerts,
                concertsStatus: concertsStatus
            "></concerts-list>

            <!-- VENUE LIST -->
            <venues-list params="
                concerts: concerts,
                concertVenues: concertVenues
            "></venues-list>

        </div>

        <!-- EXTRA INFO DISPLAY -->
        <div class="extra-info" data-bind="css: { open: showExtraInfo() }">
            <a class="close-button clickable" data-bind="click: function() { closeExtraInfo(); }">&#10006</a>

            <!-- EVENT INFO -->
            <current-event params="
                currentEvent: currentEvent
            "></current-event>

            <!-- VENUE INFO -->
            <current-venue params="
                currentVenue: currentVenue
            "></current-venue>

            <!-- ARTIST INFO -->
            <div data-bind="visible: showArtistInfo(), with: currentArtist">
                <a class="highlight clickable" data-bind="click: function() {backToEvent(currentEvent())}">back to event page</a>
                <h3 data-bind="text: name"></h3>
                <!-- ko if: $data.lastfm -->
                <p data-bind="text: lastfm.status"></p>
                <div data-bind="if: lastfm.artist">
                    <ul class="tags" data-bind="foreach: lastfm.artist.tags.tag">
                        <li class="highlight clickable" data-bind="text: name, click: function(){searchInput($data.name())}"></li>
                    </ul>
                    <h4>Bio</h4>
                    <p data-bind="html: lastfm.artist.bio.summary"></p>
                </div>
                <!-- /ko -->
                <p><a data-bind="attr : { href: url }"><span data-bind="text: name"></span>'s Bands in Town Page</a></p>
                <h4>Youtube Search Results for "<span data-bind="text: name"></span>"</h4>
                <p data-bind="text: youtubeStatus"></p>
                <ul data-bind="foreach: currentArtistYoutube">
                    <li class="youtube-link">
                        <a data-bind="text: snippet.title, attr : { href: url }"></a>
                    </li>
                </ul>
            </div>
        </div>

        <script data-main="js/init" src="js/require.js"></script>
        <script src="js/main.js"></script>
    </body>
</html>