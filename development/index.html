<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link href="css/style.css" rel="stylesheet">
        <title>Concert Map</title>

        <script src="https://maps.googleapis.com/maps/api/js?libraries=places"></script>

    </head>

    <body>
        <!-- GOOGLE MAP -->
        <div class="map-canvas" data-bind="googlemap: { mapCenter: mapCenter(), mapBounds: mapBounds() }, click: function(){closeSmallMenu()}"></div>

        <!-- MENU TOGGLE -->
        <a class="menu-toggle clickable" data-bind="click: function() { openSmallMenu(); toggleLargeMenu() }">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M2 6h20v3H2zm0 5h20v3H2zm0 5h20v3H2z"/>
          </svg>
        </a>

        <!-- EVENT SEARCH -->
        <input class="mobile-menu event-search search-box" data-bind="textInput: searchInput, css: { small: displaySmallMenu(), 'large-search': hideLargeMenu() }" placeholder="search concerts">

        <!-- LOCATION SEARCH -->
        <input class="location-search mobile-menu search-box" data-bind="value: currentAddress, css: { small: displaySmallMenu(), 'large-location': hideLargeMenu() }">

        <!-- INFO LIST TOGGLE -->
        <div class="list-toggle mobile-menu" data-bind="css: { small: displaySmallMenu(), 'large-toggle': hideLargeMenu() }">
            <button class="list-button clickable" data-bind="css: { pressed: listEvents() }, click: function () { showEvents(); }">EVENTS</button>
            <button class="list-button clickable" data-bind="css: { pressed: listVenues() }, click: function () { showVenues(); }">VENUES</button>
            <button class="info-button clickable" data-bind="css: { pressed: extraInfoBoolean() }, click: toggleExtraInfo">SHOW INFO POP-UP</button>
        </div>

        <!-- EVENT LIST -->
        <div class="mobile-menu list-container" data-bind="css: { small: displaySmallMenu(), 'large-list': hideLargeMenu() }, visible: listEvents()">
            <p class="map-error"></p>
            <p data-bind="visible: !filteredEvents().length && !concertsStatus">no results</p>
            <p data-bind="text: concertsStatus"></p>
            <p data-bind="text: geocoderStatus"></p>
            <p data-bind="if: searchInput">Search Results for: "<span data-bind="text: searchInput"></span>"</p>
            <ul class="list" data-bind="foreach: filteredEvents, click: function(){ closeSmallMenu() }">
                <li class="clickable list-item" data-bind="click: selectEvent">
                    <hr>
                        <p>
                            <span class="bold" data-bind="text: artists[0].name"></span>
                            <span class="italic" data-bind="text: subtitle"></span>
                        </p>
                        <span data-bind="text: timeInfo.day"></span>
                        <span data-bind="text: timeInfo.date"></span>
                    </p>
                    <!-- TODO: new tags or eliminate?
                    <ul class="tags" data-bind="foreach: tags.tag">
                        <li class="tags-item" data-bind="text: $data"></li>
                    </ul> -->
                    <p class="italic" data-bind="text: venue.name"></p>
                </li>
            </ul>
        </div>

        <!-- VENUE LIST -->
        <div id="venue-list" class="mobile-menu list-container" data-bind="css: { small: displaySmallMenu(), 'large-list': hideLargeMenu() }, visible: listVenues()">
            <p data-bind="text: concertsStatus"></p>
            <p data-bind="text: geocoderStatus"></p>
            <p data-bind="if: searchInput">Search Results for: "<span data-bind="text: searchInput"></span>"</p>
            <ul class="list" data-bind="foreach: filteredVenues, click: function() { closeSmallMenu() }">
                <li class="clickable list-item" data-bind="click: selectFilteredVenue">
                    <hr>
                    <h4 data-bind="text: name"></h4>
                    <p class="pale-text">
                        <span data-bind="text: city"></span>
                        , 
                        <span data-bind="text: region"></span>
                    </p>
                    <p class="italic">
                        <span data-bind="text: concerts.length"></span>
                        <span data-bind="if: concerts.length > 1"> events</span>
                        <span data-bind="if: concerts.length == 1"> event</span>
                    </p>
                </li>
            </ul>
        </div>



        <!-- EXTRA INFO DISPLAY -->
        <div class="extra-info" data-bind="css: { 'open': showExtraInfo() }">
            <a class="close-button clickable" data-bind="click: function() { closeExtraInfo(); }">
                <img class="svg-button" src="images/close.svg" alt="CLOSE">
            </a>

            <!-- EVENT INFO -->
            <div class="extra-info-content" data-bind="visible: showEventInfo(), with: currentEvent">
                <div>
                    <p>
                        <span class="bold larger" data-bind="text: artists()[0].name"></span>
                        <span class="italic" data-bind="text: subtitle"></span>
                    </p>
                    <p class="pale-text">
                        <span data-bind="text: timeInfo.time"></span>
                        <br>
                        <span data-bind="text: timeInfo.day"></span>
                        <span data-bind="text: timeInfo.date"></span>
                        <br>
                        <span data-bind="text: timeInfo.year"></span>
                    </p>
                </div>
                <h4>Artists</h4>
                <hr>
                <ul data-bind="foreach: artists">
                    <li>
                        <a class="clickable" data-bind="text: name, click: function() { selectArtist($data); }"></a>
                        <div data-bind="if: lastfm.artist">
                                <ul class="tags" data-bind="foreach: lastfm.artist.tags.tag">
                                    <li class="clickable tags-item" data-bind="text: name, click: function() { searchInput(this.name()) }"></li>
                                </ul>
                                <!-- TODO: combine with below or change message? -->
                                <span class="italic" data-bind="if: !lastfm.artist.tags.tag().length">no genre info</span>
                        </div>
                        <!-- TODO: combine with above? -->
                        <span class="italic" data-bind="if: $data.lastfm.error">no additional info</span>
                    </li>
                    <br>
                </ul>
                <p>
                    <span class="bold">Venue</span>
                    <a class="clickable italic" data-bind="text: venue.name, click: function() { selectVenue(); }"></a>
                </p>
                <a data-bind="attr: { href: url }">Bands in Town Event Page</a>
                <br>
                <p data-bind="if: tickets_available"><a data-bind="attr: { href: ticket_url }">Get Tickets</a></p>
            </div>

            <!-- VENUE INFO -->
            <div class="extra-info-content" data-bind="visible: showVenueInfo(), with: currentVenue">
                <p data-bind="text: venueInfoStatus"></p>
                <h3 data-bind="text: name"></h3>
                <h4>Upcoming Events</h4>
                <ul data-bind="foreach: concerts">
                    <li>
                        <a class="clickable" data-bind="text: artists[0].name, click: self.selectEvent"></a>
                        <span class="italic" data-bind="text: subtitle"></span>
                    </li>
                    <br>
                </ul>
                <p class="pale-text">
                    <span data-bind="text: city"></span>,
                    <span data-bind="text: region"></span>
                </p>

                <!-- TODO: display four square data -->
                <div data-bind="with: currentVenueFourSquare">
                    <p data-bind="text: name"></p>
                    <!-- old data binds, TODO: update
                    <ul class="tags" data-bind="foreach: categories">
                        <li class="tags-item" data-bind="text: shortName"></li>
                    </ul>
                    <div data-bind="if: $data.rating">
                        <p>
                            <span class="pale-text">Four Square Rating </span>
                            <span class="italic" data-bind="text: $data.rating"></span>
                        </p>
                    </div>
                    <a data-bind="attr: { href: canonicalUrl }">Visit <span data-bind="text: name"></span>'s Four Square Page</a>
                    <div data-bind="if: $data.description">
                        <h4>Description from Four Square</h4>
                        <p data-bind="text: $data.description"></p>
                    </div> -->
                </div>

                <!-- TODO: display places data -->
                <div data-bind="with: currentVenuePlaces">
                    <p data-bind="text: name"></p>
                </div>

                <!-- TODO: replace with official website if supplied by 4square
                <p data-bind="if: website"><a data-bind="attr: { href: website }">Visit <span data-bind="text: name"></span>'s Offical Website</a></p> -->

                <!-- TODO: links section? -->
                <p>
                    <a data-bind="attr: { href: url }">Visit <span data-bind="text: name"></span>'s Bands in Town Page</a>
                </p>
            </div>

            <!-- ARTIST INFO -->
            <div class="extra-info-content" data-bind="visible: showArtistInfo(), with: currentArtist">
                <h3 data-bind="text: name"></h3>
                <p data-bind="text: lastfm.error"></p>
                <div data-bind="if: lastfm.artist">
                    <ul class="tags" data-bind="foreach: lastfm.artist.tags.tag">
                        <li class="tags-item clickable" data-bind="text: name, click: function(){searchInput($data.name())}"></li>
                    </ul>
                    <h4>Bio</h4>
                    <p data-bind="html: lastfm.artist.bio.summary"></p>
                </div>
                <p><a data-bind="attr : { href: url }"><span data-bind="text: name"></span>'s Bands in Town Page</a></p>
                <h4>Youtube Search Results for "<span data-bind="text: name"></span>"</h4>
                <p data-bind="text: youtubeStatus"></p>
                <ul data-bind="foreach: currentArtistYoutube">
                    <li class="youtube-link">
                        <a data-bind="text: snippet.title, attr : { href: url }"></a>
                    </li>
                </ul>
            </div>

        </div>

        <script src="js/libraries/jquery-2.1.3.min.js"></script>
        <script src="js/libraries/knockout-3.3.0.js"></script>
        <script src="js/libraries/knockout.mapping-latest.js"></script>
        <script src="js/app.js" inline></script>

    </body>
</html>